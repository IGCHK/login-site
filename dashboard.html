<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBL-biUfPdgOoJvqgpD-drdcCNVXERlJ6Y",
    authDomain: "igchkwebsite.firebaseapp.com",
    projectId: "igchkwebsite",
    storageBucket: "igchkwebsite.appspot.com",
    messagingSenderId: "575146782620",
    appId: "1:575146782620:web:36853d54456714d5d6e259"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const greetingEl = document.getElementById("greeting");
  const fileList = document.createElement("ul");
  document.body.appendChild(fileList);

  onAuthStateChanged(auth, async (user) => {
    if (user && user.emailVerified) {
      greetingEl.textContent = `Hi ${user.email}!`;

      try {
        const res = await fetch("https://web.igchkshop.dpdns.org/files.json");
        const data = await res.json();
        const currentUser = data.users.find(u => u.email === user.email);

        if (currentUser && currentUser.files.length > 0) {
          currentUser.files.forEach(file => {
            const li = document.createElement("li");
            const link = document.createElement("a");
            link.href = file.url;
            link.textContent = file.label;
            link.target = "_blank";
            li.appendChild(link);
            fileList.appendChild(li);
          });
        } else {
          fileList.innerHTML = "<li>No files assigned to your account.</li>";
        }

      } catch (err) {
        fileList.innerHTML = "<li>Error loading files.</li>";
        console.error("Error fetching file list:", err);
      }

    } else {
      window.location.href = "index.html";
    }
  });
</script>
